# MetroPlan 前端功能实现说明

## 概述

已在 `metroplan/src/pages/index/index.vue` 中实现前端基本功能，包括：
1. **两个输入框**：起点站和终点站输入
2. **查询功能**：调用后端API查询路径
3. **输出区域**：展示查询结果和车站列表

## 功能详情

### 1. 输入区域

- **起点站输入框**：输入出发地车站名称
- **终点站输入框**：输入目的地车站名称
- **清空按钮**：每个输入框都支持一键清空
- **输入验证**：提交前检查输入不为空

### 2. 操作按钮

#### 查询路径按钮
- 调用后端 `/path` 接口
- 请求参数：
  - `start_station`：起点站名称
  - `end_station`：终点站名称
  - `max_transfers`：最大换乘次数（固定为2）
- 支持加载动画和加载状态

#### 获取车站列表按钮
- 调用后端 `/stations` 接口
- 显示所有可用车站，方便用户参考

### 3. 结果展示

#### 路径卡片信息
每条路径包含以下信息：
- **路径类型标签**：直达（绿色）或换乘（黄色）
- **时间段**：出发时间 → 到达时间
- **耗时**：总耗时（以紫色徽章显示）
- **列车序列**：使用的列车车次
- **总耗时**：分钟数
- **换乘次数**：需要换乘的次数
- **快速列车标签**：如果包含快速列车会显示标签

#### 换乘详情
- 显示每次换乘的具体信息：
  - 换乘站点名称
  - 到达时间和出发时间
  - 等待时间

#### 车站列表
- 以网格布局展示所有可用车站
- 使用渐变紫色背景，便于区分

### 4. 用户交互

- **实时反馈**：操作完成后显示提示消息
- **错误处理**：捕获网络错误和API错误，显示友好提示
- **加载状态**：按钮在请求期间显示加载动画
- **空状态**：未查询时显示友好的空状态提示

## 使用步骤

### 前置条件
1. 确保后端API服务正在运行（`python app.py`）
2. 确保后端服务地址为 `http://localhost:5000`

### 运行前端
```powershell
cd metroplan

# 安装依赖（如果未安装）
yarn install
# 或
npm install

# 启动开发服务器（H5模式）
yarn serve
# 或
npm run serve
```

### 使用流程
1. 打开应用后，在起点站输入框输入起始车站名称
2. 在终点站输入框输入目的地车站名称
3. 点击"查询路径"按钮进行查询
4. 等待结果显示，选择合适的路径方案
5. 可点击"获取车站列表"查看所有可用车站

## API集成

### 调用的后端接口

#### 1. POST /path - 路径查询
```javascript
const payload = {
  start_station: "广州南",
  end_station: "深圳北",
  max_transfers: 2
};
```

**响应处理**：
- 成功：提取 `data.paths` 数组，渲染路径卡片
- 失败：显示错误提示信息

#### 2. GET /stations - 获取车站列表
**响应处理**：
- 成功：提取 `data.stations` 数组，以网格布局显示
- 失败：显示错误提示信息

## 技术实现细节

### 使用的uni-app/uview组件
- `u-input`：输入框组件
- `u-button`：按钮组件
- `u-tag`：标签组件（路径类型、快速列车标识）
- `u-toast`：提示消息组件

### HTTP请求
- 使用 `uni.request()` 进行跨域请求
- 设置 `Content-Type: application/json`
- 支持请求失败重试提示

### 样式特点
- **响应式设计**：使用rpx单位适配不同屏幕
- **渐变色**：紫色渐变背景（#667eea → #764ba2）
- **卡片布局**：结果以卡片形式展示，层次清晰
- **色彩反馈**：不同状态使用不同颜色

## 配置说明

### API基础URL配置
如需修改API地址，编辑 `index.vue` 中的：
```javascript
apiBaseUrl: 'http://localhost:5000'
```

### 最大换乘次数配置
在查询请求中修改 `max_transfers` 参数：
```javascript
max_transfers: 2  // 改为需要的值
```

## 常见问题

### Q: 提示"网络错误，请检查API是否运行"
**A**: 确保后端服务已启动，运行 `python app.py`

### Q: 查询时显示找不到路径
**A**: 检查输入的车站名称是否正确，可先点击"获取车站列表"查看可用车站

### Q: 在小程序中运行时报错
**A**: 小程序需要配置域名白名单，在 `manifest.json` 中添加后端API地址到白名单

### Q: 样式显示不正常
**A**: 确保 `App.vue` 中已导入uview样式：`@import 'uview-ui/index.scss';`

## 后续扩展建议

1. **优化搜索**：添加车站搜索下拉列表，支持模糊匹配
2. **路径对比**：允许选择和对比多条路径
3. **收藏功能**：保存常用的起终点组合
4. **时间选择**：支持选择特定时间的列车
5. **实时更新**：显示列车实时运行状态
6. **地图集成**：展示路径的地理位置

---

**最后更新**: 2024-12-03  
**前端框架**: uni-app + Vue 2  
**UI组件库**: uview-ui 2.0.36
